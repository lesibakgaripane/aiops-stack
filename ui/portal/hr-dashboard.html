<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HR · Awareness Metrics</title>
  <link rel="stylesheet" href="portal.css">
</head>
<body class="page">
  <header>
    <img src="LesiBytes-Logo.png" class="lb-logo-small" alt="LesiBytes logo">
    <div>
      <div class="brand">LESIBYTES</div>
      <div class="tagline">HR · PEOPLE & RISK INSIGHTS</div>
    </div>
  </header>

  <main class="main">
    <div class="card">
      <h2>Engagement snapshot (demo)</h2>
      <p>
        This view is meant for HR to see how many modules are completed, average scores,
        and which content resonates. For now, we compute simple aggregates from quiz data.
      </p>
      <pre id="hr-metrics" class="code-box"></pre>
    </div>
  </main>

  <div id="chat-widget-container"></div>
  <script src="chat-widget.js"></script>

  <script>
    function computeMetrics(scores) {
      if (!Array.isArray(scores) || scores.length === 0) {
        return { total_submissions: 0 };
      }
      const total = scores.length;
      let correct = 0;
      scores.forEach(s => { if (s.score === "1") correct += 1; });
      return {
        total_submissions: total,
        correct_answers: correct,
        correct_ratio: (correct / total).toFixed(2)
      };
    }

    fetch("/ui-api/get_scores")
      .then(r => r.json())
      .then(data => {
        const metrics = computeMetrics(data);
        document.getElementById("hr-metrics").innerText =
          JSON.stringify(metrics, null, 2);
      })
      .catch(() => {
        document.getElementById("hr-metrics").innerText = "No data available yet.";
      });
  </script>
</body>
</html>
