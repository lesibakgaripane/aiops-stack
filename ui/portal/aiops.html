<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AIOps Operations Center</title>
</head>
<body>
  <h1>AIOps Operations Center</h1>

  <p>Welcome, <span id="user-name">user</span>.</p>

  <nav>
    <a href="home.html">Home</a> |
    <a href="aiops.html">AIOps Operations Center</a> |
    <a href="awareness.html">Cybersecurity Awareness</a> |
    <a href="ecosystem.html">Ecosystem Health</a>
  </nav>

  <hr />

  <h2>AIOps Overview (MVP)</h2>
  <p>This view shows a simple AIOps summary coming from the ui-gateway.</p>

  <h3>Summary (from API)</h3>
  <p><strong>Status:</strong> <span id="aiops-status">Loading...</span></p>
  <p><strong>Message:</strong> <span id="aiops-msg">Loading...</span></p>

  <h4>Alerts</h4>
  <ul id="aiops-alerts">
    <li>Loading...</li>
  </ul>

  <button id="logout-btn">Logout</button>

  <script src="auth.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Enforce authentication
      window.aiopsAuth.requireAuth("login.html");

      const auth = window.aiopsAuth.getAuth();
      const userNameEl = document.getElementById("user-name");
      if (auth && auth.username) {
        userNameEl.textContent = auth.username;
      }

      const logoutBtn = document.getElementById("logout-btn");
      logoutBtn.addEventListener("click", function () {
        window.aiopsAuth.clearAuth();
        window.location.href = "login.html";
      });

      const statusEl = document.getElementById("aiops-status");
      const msgEl = document.getElementById("aiops-msg");
      const alertsEl = document.getElementById("aiops-alerts");

      fetch("/aiops/summary")
        .then(resp => {
          if (!resp.ok) {
            throw new Error("HTTP " + resp.status);
          }
          return resp.json();
        })
        .then(data => {
          statusEl.textContent = data.status || "unknown";
          msgEl.textContent = data.message || "No message";

          const alerts = data.alerts || [];
          alertsEl.innerHTML = "";
          if (alerts.length === 0) {
            const li = document.createElement("li");
            li.textContent = "No alerts reported.";
            alertsEl.appendChild(li);
            return;
          }

          for (const a of alerts) {
            const li = document.createElement("li");
            li.textContent = a;
            alertsEl.appendChild(li);
          }
        })
        .catch(err => {
          console.error("AIOps summary error:", err);
          statusEl.textContent = "ERROR";
          msgEl.textContent = "Failed to fetch AIOps summary.";
          alertsEl.innerHTML = "";
          const li = document.createElement("li");
          li.textContent = "Error fetching AIOps summary: " + err;
          alertsEl.appendChild(li);
        });
    });
  </script>

  <script src="chat-widget.js"></script>
</body>
</html>
